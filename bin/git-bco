#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

fzf_select_ref() {
	fzf --height=30% --preview 'git log --color --oneline {} ^$(git merge-base HEAD {})'
}

ARGS=()
BRANCH=""
while [ $# -gt 0 ]; do
	case "$1" in
		-*)
			ARGS+=("$1"); shift
			;;
		*)
			BRANCH="$1"; shift
			break
			;;
	esac
done

if [ -z "$BRANCH" ]; then
	BRANCH=$(git branch | rg -v '^\*' | cut -c3- | fzf_select_ref)
fi

if [ -z "$BRANCH" ]; then
	echo "No branch selected"
	exit 1
fi

ARGS+=("$BRANCH")
git checkout "${ARGS[@]}"
